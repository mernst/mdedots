Unparsing cleanups

The major change modifies the prototypes to take a LexStream * instead of a
LexStream&.  There are three reasons for this change:
 * efficiency:  it is faster to pass a pointer than a struct, especially
   since the argument often is never even referenced.
 * consistency:  other arguments throughout Jikes are passe as pointers
   rather than references.
 * modifiability:  if bodies need to use a different value than the
   argument, this eases such manipulations, because the formal parameter
   can simply be assigned to the desired substitution.

Other changes fix a bug in AstThisCall and clean up the code a bit.


2001-10-06  Michael Ernst  <mernst@alum.mit.edu>

	* src/unparse.cpp: Adjust bodies to use LexStream *.  Replace a
	remaining use of "\n" by endl.  Add comment.  Make line breaks in
	if statements consistent.  Fix check of base_opt in
	AstThisCall::Unparse.
	* src/ast.h: Adjust Unparse prototypes to take LexStream *, not
	LexStream&.  Add base_opt and dot_token_opt to AstThisCall.

diff -u -r --exclude=*~ --exclude=*.o --exclude=jikes src/ast.h ../jikes-1.15-patched/src/ast.h
--- src/ast.h	Fri Sep 28 21:12:18 2001
+++ ../jikes-1.15-patched/src/ast.h	Sat Oct  6 23:03:07 2001
@@ -394,7 +394,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     //
@@ -800,7 +800,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -836,7 +836,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -867,7 +867,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -916,7 +916,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -958,7 +958,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -988,7 +988,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1019,7 +1019,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1072,8 +1072,10 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(LexStream &, char * directory); // special form
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
+
+    // special forms
+    virtual void Unparse(LexStream *, const char * const directory);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1129,7 +1131,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1158,7 +1160,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1274,7 +1276,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1350,7 +1352,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1397,7 +1399,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1438,7 +1440,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1475,7 +1477,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1532,7 +1534,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1576,7 +1578,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1628,7 +1630,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1693,7 +1695,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1725,7 +1727,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1750,6 +1752,8 @@
 public:
     MethodSymbol *symbol;
 
+    AstExpression *base_opt;
+    LexStream::TokenIndex dot_token_opt;
     LexStream::TokenIndex this_token;
     LexStream::TokenIndex left_parenthesis_token;
     LexStream::TokenIndex right_parenthesis_token;
@@ -1782,7 +1786,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1846,7 +1850,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1905,7 +1909,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -1955,7 +1959,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2079,7 +2083,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2130,7 +2134,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2192,7 +2196,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2232,7 +2236,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2269,7 +2273,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2310,7 +2314,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2340,7 +2344,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2392,7 +2396,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2454,7 +2458,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2492,7 +2496,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2532,7 +2536,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2591,7 +2595,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2630,7 +2634,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2668,7 +2672,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2706,7 +2710,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2744,7 +2748,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2782,7 +2786,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2818,7 +2822,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2848,7 +2852,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2892,7 +2896,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2961,7 +2965,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -2992,7 +2996,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3023,7 +3027,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3053,7 +3057,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3083,7 +3087,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3113,7 +3117,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3143,7 +3147,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3173,7 +3177,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3203,7 +3207,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3233,7 +3237,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3264,7 +3268,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3297,7 +3301,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3328,7 +3332,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3393,7 +3397,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3427,7 +3431,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3478,7 +3482,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3555,7 +3559,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3613,7 +3617,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3647,7 +3651,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3705,7 +3709,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3763,7 +3767,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3814,7 +3818,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3892,7 +3896,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -3927,7 +3931,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
@@ -4010,7 +4014,7 @@
 
 #ifdef JIKES_DEBUG
     virtual void Print(LexStream &);
-    virtual void Unparse(Ostream &, LexStream &);
+    virtual void Unparse(Ostream &, LexStream *);
 #endif
 
     virtual Ast *Clone(StoragePool *);
diff -u -r --exclude=*~ --exclude=*.o --exclude=jikes src/unparse.cpp ../jikes-1.15-patched/src/unparse.cpp
--- src/unparse.cpp	Fri Sep 28 21:12:19 2001
+++ ../jikes-1.15-patched/src/unparse.cpp	Sat Oct  6 23:13:03 2001
@@ -22,7 +22,7 @@
 // Special top-level form
 void AstCompilationUnit::Unparse(LexStream& lex_stream, char *directory)
 {
-    char *in_file_name = lex_stream.FileName();
+    char *in_file_name = lex_stream -> FileName();
     // char *suffix = ".unparse";
     char *suffix = "";
     char *out_file_name = strcat3(directory, in_file_name, suffix);
@@ -50,7 +50,7 @@
     delete[] out_file_name;
 }
 
-void Ast::Unparse(Ostream& os, LexStream& lex_stream)
+void Ast::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (debug_unparse)
         os << "/*Ast:#" << this-> id << "*/";
@@ -62,17 +62,19 @@
         os << "/*:Ast#" << this-> id << "*/";
 }
 
-void AstBlock::Unparse(Ostream& os, LexStream& lex_stream)
+void AstBlock::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstBlock:#" << this-> id << "*/";
     if (Ast::debug_unparse)
         os << "/*no_braces:" << (int) no_braces << "*/";
     if (! no_braces)
-        os << "{\n";
+        os << "{" << endl;
+    // Open brace, if any, must precede labels (e.g., to avoid separating
+    // labels from following for statement).
     for (int il = 0; il < this -> NumLabels(); il++)
     {
-        os << lex_stream.NameString(this -> Label(il)) << ": ";
+        os << lex_stream -> NameString(this -> Label(il)) << ": ";
     }
 
     for (int is = 0; is < this -> NumStatements(); is++)
@@ -85,16 +87,16 @@
         os << "/*:AstBlock#" << this-> id << "*/";
 }
 
-void AstPrimitiveType::Unparse(Ostream& os, LexStream& lex_stream)
+void AstPrimitiveType::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstPrimitiveType:#" << this-> id << "*/";
-    os << lex_stream.NameString(primitive_kind_token);
+    os << lex_stream -> NameString(primitive_kind_token);
     if (Ast::debug_unparse)
         os << "/*:AstPrimitiveType#" << this-> id << "*/";
 }
 
-void AstArrayType::Unparse(Ostream& os, LexStream& lex_stream)
+void AstArrayType::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstArrayType:#" << this-> id << "*/";
@@ -105,20 +107,20 @@
         os << "/*:AstArrayType#" << this-> id << "*/";
 }
 
-void AstSimpleName::Unparse(Ostream& os, LexStream& lex_stream)
+void AstSimpleName::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstSimpleName:#" << this-> id << "*/";
-    os << lex_stream.NameString(identifier_token);
+    os << lex_stream -> NameString(identifier_token);
     if (Ast::debug_unparse)
         os << "/*:AstSimpleName#" << this-> id << "*/";
 }
 
-void AstPackageDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstPackageDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstPackageDeclaration:#" << this-> id << "*/";
-    os << lex_stream.NameString(package_token);
+    os << lex_stream -> NameString(package_token);
     os << " ";
     name -> Unparse(os, lex_stream);
     os << ";" << endl;
@@ -126,26 +128,27 @@
         os << "/*:AstPackageDeclaration#" << this-> id << "*/";
 }
 
-void AstImportDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstImportDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstImportDeclaration:#" << this-> id << "*/";
-    os << lex_stream.NameString(import_token);
+    os << lex_stream -> NameString(import_token);
     os << " ";
     name -> Unparse(os, lex_stream);
     os << (star_token_opt ? "." : "");
     if (star_token_opt)
-        os << lex_stream.NameString(star_token_opt);
+        os << lex_stream -> NameString(star_token_opt);
     os << ";" << endl;
     if (Ast::debug_unparse)
         os << "/*:AstImportDeclaration#" << this-> id << "*/";
 }
 
-void AstCompilationUnit::Unparse(Ostream& os, LexStream& lex_stream)
+void AstCompilationUnit::Unparse(Ostream& os, LexStream * lex_stream)
 {
-    if (Ast::debug_unparse) os << "/*AstCompilationUnit:#" << this-> id << "*/";
+    if (Ast::debug_unparse)
+        os << "/*AstCompilationUnit:#" << this-> id << "*/";
     // The file is
-    // os << lex_stream.FileName();
+    // os << lex_stream -> FileName();
     if (package_declaration_opt)
         package_declaration_opt -> Unparse(os, lex_stream);
     for (int m = 0; m < this -> NumImportDeclarations(); m++)
@@ -156,27 +159,27 @@
         os << "/*:AstCompilationUnit#" << this-> id << "*/";
 }
 
-void AstModifier::Unparse(Ostream& os, LexStream& lex_stream)
+void AstModifier::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstModifier:#" << this-> id << "*/";
-    os << lex_stream.NameString(modifier_kind_token);
+    os << lex_stream -> NameString(modifier_kind_token);
     os << " ";
     if (Ast::debug_unparse)
        os << "/*:AstModifier#" << this-> id << "*/";
 }
 
-void AstEmptyDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstEmptyDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
        os << "/*AstEmptyDeclaration:#" << this-> id << "*/";
-    os << lex_stream.NameString(semicolon_token);
+    os << lex_stream -> NameString(semicolon_token);
     os << endl;
     if (Ast::debug_unparse)
     os << "/*:AstEmptyDeclaration#" << this-> id << "*/";
 }
 
-void AstClassBody::Unparse(Ostream& os, LexStream& lex_stream)
+void AstClassBody::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstClassBody:#" << this-> id << "*/";
@@ -188,18 +191,18 @@
         os << "/*:AstClassBody#" << this-> id << "*/";
 }
 
-void AstClassDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstClassDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstClassDeclaration:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumClassModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> ClassModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> ClassModifier(i) -> modifier_kind_token);
         os << " ";
     }
-    os << lex_stream.NameString(class_token);
+    os << lex_stream -> NameString(class_token);
     os << " ";
-    os << lex_stream.NameString(identifier_token);
+    os << lex_stream -> NameString(identifier_token);
     os << " ";
     if (super_opt)
     {
@@ -224,7 +227,7 @@
         os << "/*:AstClassDeclaration#" << this-> id << "*/";
 }
 
-void AstArrayInitializer::Unparse(Ostream& os, LexStream& lex_stream)
+void AstArrayInitializer::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstArrayInitializer:#" << this-> id << "*/";
@@ -240,7 +243,7 @@
         os << "/*:AstArrayInitializer#" << this-> id << "*/";
 }
 
-void AstBrackets::Unparse(Ostream& os, LexStream& lex_stream)
+void AstBrackets::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstBrackets:#" << this-> id << "*/";
@@ -249,18 +252,18 @@
         os << "/*:AstBrackets#" << this-> id << "*/";
 }
 
-void AstVariableDeclaratorId::Unparse(Ostream& os, LexStream& lex_stream)
+void AstVariableDeclaratorId::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstVariableDeclaratorId:#" << this-> id << "*/";
-    os << lex_stream.NameString(identifier_token);
+    os << lex_stream -> NameString(identifier_token);
     for (int i = 0; i < NumBrackets(); i++)
         os << "[]";
     if (Ast::debug_unparse)
         os << "/*:AstVariableDeclaratorId#" << this-> id << "*/";
 }
 
-void AstVariableDeclarator::Unparse(Ostream& os, LexStream& lex_stream)
+void AstVariableDeclarator::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstVariableDeclarator:#" << this-> id << "*/";
@@ -274,13 +277,13 @@
         os << "/*:AstVariableDeclarator#" << this-> id << "*/";
 }
 
-void AstFieldDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstFieldDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstFieldDeclaration:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumVariableModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> VariableModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> VariableModifier(i) -> modifier_kind_token);
         os << " ";
     }
     type -> Unparse(os, lex_stream);
@@ -296,13 +299,13 @@
         os << "/*:AstFieldDeclaration#" << this-> id << "*/";
 }
 
-void AstFormalParameter::Unparse(Ostream& os, LexStream& lex_stream)
+void AstFormalParameter::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstFormalParameter:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumParameterModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> ParameterModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> ParameterModifier(i) -> modifier_kind_token);
         os << " ";
     }
     type -> Unparse(os, lex_stream);
@@ -312,11 +315,11 @@
         os << "/*:AstFormalParameter#" << this-> id << "*/";
 }
 
-void AstMethodDeclarator::Unparse(Ostream& os, LexStream& lex_stream)
+void AstMethodDeclarator::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstMethodDeclarator:#" << this-> id << "*/";
-    os << lex_stream.NameString(identifier_token);
+    os << lex_stream -> NameString(identifier_token);
     os << " (";
     for (int k = 0; k < this -> NumFormalParameters(); k++)
     {
@@ -331,13 +334,13 @@
         os << "/*:AstMethodDeclarator#" << this-> id << "*/";
 }
 
-void AstMethodDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstMethodDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstMethodDeclaration:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumMethodModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> MethodModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> MethodModifier(i) -> modifier_kind_token);
         os << " ";
     }
     type -> Unparse(os, lex_stream);
@@ -358,21 +361,21 @@
         os << "/*:AstMethodDeclaration#" << this-> id << "*/";
 }
 
-void AstStaticInitializer::Unparse(Ostream& os, LexStream& lex_stream)
+void AstStaticInitializer::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstStaticInitializer:#" << this-> id << "*/";
-    os << lex_stream.NameString(static_token);
+    os << lex_stream -> NameString(static_token);
     block -> Unparse(os, lex_stream);
     if (Ast::debug_unparse)
         os << "/*:AstStaticInitializer#" << this-> id << "*/";
 }
 
-void AstThisCall::Unparse(Ostream& os, LexStream& lex_stream)
+void AstThisCall::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstThisCall:#" << this-> id << "*/";
-    os << lex_stream.NameString(this_token);
+    os << lex_stream -> NameString(this_token);
     os << " (";
     for (int i = 0; i < this -> NumArguments(); i++)
     {
@@ -385,34 +388,36 @@
         os << "/*:AstThisCall#" << this-> id << "*/";
 }
 
-void AstSuperCall::Unparse(Ostream& os, LexStream& lex_stream)
+void AstSuperCall::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstSuperCall:#" << this-> id << "*/";
-    if (wcscmp(lex_stream.NameString(super_token), L"super") == 0)
+    if (wcscmp(lex_stream -> NameString(super_token), L"super") == 0)
     {
-        if (base_opt)
+        // If base_opt is set but dot_token_opt is not, then base_opt
+        // is itself "super" and so it need not be specially output.
+        if (base_opt && dot_token_opt)
         {
             base_opt -> Unparse(os, lex_stream);
-            os << lex_stream.NameString(dot_token_opt);
+            os << lex_stream -> NameString(dot_token_opt);
         }
-        os << lex_stream.NameString(super_token);
-        os << lex_stream.NameString(left_parenthesis_token);
+        os << lex_stream -> NameString(super_token);
+        os << lex_stream -> NameString(left_parenthesis_token);
         for (int j = 0; j < NumArguments(); j++)
         {
             if (j>0)
                 os << ", ";
             this -> Argument(j) -> Unparse(os, lex_stream);
         }
-        os << lex_stream.NameString(right_parenthesis_token);
-        os << lex_stream.NameString(semicolon_token);
+        os << lex_stream -> NameString(right_parenthesis_token);
+        os << lex_stream -> NameString(semicolon_token);
         os << endl;
     }
     if (Ast::debug_unparse)
          os << "/*:AstSuperCall#" << this-> id << "*/";
 }
 
-void AstConstructorBlock::Unparse(Ostream& os, LexStream& lex_stream)
+void AstConstructorBlock::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstConstructorBlock:#" << this-> id << "*/";
@@ -429,13 +434,13 @@
         os << "/*:AstConstructorBlock#" << this-> id << "*/";
 }
 
-void AstConstructorDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstConstructorDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstConstructorDeclaration:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumConstructorModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> ConstructorModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> ConstructorModifier(i) -> modifier_kind_token);
         os << " ";
     }
     constructor_declarator -> Unparse(os, lex_stream);
@@ -444,7 +449,8 @@
         os << " throws ";
         for (int k = 0; k < this -> NumThrows(); k++)
         {
-            if (k>0) os << ", ";
+            if (k>0)
+                os << ", ";
             this -> Throw(k) -> Unparse(os, lex_stream);
         }
     }
@@ -453,18 +459,18 @@
         os << "/*:AstConstructorDeclaration#" << this-> id << "*/";
 }
 
-void AstInterfaceDeclaration::Unparse(Ostream& os, LexStream& lex_stream)
+void AstInterfaceDeclaration::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstInterfaceDeclaration:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumInterfaceModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> InterfaceModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> InterfaceModifier(i) -> modifier_kind_token);
         os << " ";
     }
-    os << lex_stream.NameString(interface_token);
+    os << lex_stream -> NameString(interface_token);
     os << " ";
-    os << lex_stream.NameString(identifier_token);
+    os << lex_stream -> NameString(identifier_token);
     if (NumExtendsInterfaces() > 0)
     {
         os << " extends ";
@@ -486,13 +492,13 @@
         os << "/*:AstInterfaceDeclaration#" << this-> id << "*/";
 }
 
-void AstLocalVariableDeclarationStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstLocalVariableDeclarationStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstLocalVariableDeclarationStatement:#" << this-> id << "*/";
     for (int i = 0; i < this -> NumLocalModifiers(); i++)
     {
-        os << lex_stream.NameString(this -> LocalModifier(i) -> modifier_kind_token);
+        os << lex_stream -> NameString(this -> LocalModifier(i) -> modifier_kind_token);
         os << " ";
     }
     type -> Unparse(os, lex_stream);
@@ -509,11 +515,11 @@
         os << "/*:AstLocalVariableDeclarationStatement#" << this-> id << "*/";
 }
 
-void AstIfStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstIfStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstIfStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(if_token);
+    os << lex_stream -> NameString(if_token);
     AstParenthesizedExpression *parenth = expression -> ParenthesizedExpressionCast();
     if (!parenth)
         os << "(";
@@ -532,17 +538,17 @@
         os << "/*:AstIfStatement#" << this-> id << "*/";
 }
 
-void AstEmptyStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstEmptyStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstEmptyStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(semicolon_token);
+    os << lex_stream -> NameString(semicolon_token);
     os << endl;
     if (Ast::debug_unparse)
         os << "/*:AstEmptyStatement#" << this-> id << "*/";
 }
 
-void AstExpressionStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstExpressionStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstExpressionStatement:#" << this-> id << "*/";
@@ -553,11 +559,11 @@
         os << "/*:AstExpressionStatement#" << this-> id << "*/";
 }
 
-void AstCaseLabel::Unparse(Ostream& os, LexStream& lex_stream)
+void AstCaseLabel::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstCaseLabel:#" << this-> id << "*/";
-    os << lex_stream.NameString(case_token);
+    os << lex_stream -> NameString(case_token);
     os << " ";
     expression -> Unparse(os, lex_stream);
     os << ":" << endl;
@@ -565,17 +571,17 @@
         os << "/*:AstCaseLabel#" << this-> id << "*/";
 }
 
-void AstDefaultLabel::Unparse(Ostream& os, LexStream& lex_stream)
+void AstDefaultLabel::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstDefaultLabel:#" << this-> id << "*/";
-    os << lex_stream.NameString(default_token);
+    os << lex_stream -> NameString(default_token);
     os << ":" << endl;
     if (Ast::debug_unparse)
         os << "/*:AstDefaultLabel#" << this-> id << "*/";
 }
 
-void AstSwitchBlockStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstSwitchBlockStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstSwitchBlockStatement:#" << this-> id << "*/";
@@ -587,12 +593,12 @@
         os << "/*:AstSwitchBlockStatement#" << this-> id << "*/";
 }
 
-void AstSwitchStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstSwitchStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstSwitchStatement:#" << this-> id << "*/";
   // What about the label_opt??
-    os << lex_stream.NameString(switch_token);
+    os << lex_stream -> NameString(switch_token);
     AstParenthesizedExpression *parenth = expression -> ParenthesizedExpressionCast();
     if (!parenth)
         os << "(";
@@ -608,11 +614,11 @@
         os << "/*:AstSwitchStatement#" << this-> id << "*/";
 }
 
-void AstWhileStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstWhileStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstWhileStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(while_token);
+    os << lex_stream -> NameString(while_token);
     // What about Label_opt?
     os << " ";
     AstParenthesizedExpression *parenth = expression -> ParenthesizedExpressionCast();
@@ -627,31 +633,31 @@
         os << "/*:AstWhileStatement#" << this-> id << "*/";
 }
 
-void AstDoStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstDoStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstDoStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(do_token);
+    os << lex_stream -> NameString(do_token);
     os << endl;
     statement -> Unparse(os, lex_stream);
-    os << lex_stream.NameString(while_token);
+    os << lex_stream -> NameString(while_token);
     AstParenthesizedExpression *parenth = expression -> ParenthesizedExpressionCast();
     if (!parenth)
         os << "(";
     expression -> Unparse(os, lex_stream);
     if (!parenth)
         os << ")";
-    os << lex_stream.NameString(semicolon_token);
+    os << lex_stream -> NameString(semicolon_token);
     os << endl;
     if (Ast::debug_unparse)
         os << "/*:AstDoStatement#" << this-> id << "*/";
 }
 
-void AstForStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstForStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstForStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(for_token);
+    os << lex_stream -> NameString(for_token);
     os << " (";
     for (int i = 0; i < this -> NumForInitStatements(); i++)
     {
@@ -675,43 +681,43 @@
         os << "/*:AstForStatement#" << this-> id << "*/";
 }
 
-void AstBreakStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstBreakStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstBreakStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(break_token);
+    os << lex_stream -> NameString(break_token);
     if (identifier_token_opt)
     {
         os << " ";
-        os << lex_stream.NameString(identifier_token_opt);
+        os << lex_stream -> NameString(identifier_token_opt);
     }
     os << ";" << endl;
     if (Ast::debug_unparse)
         os << "/*:AstBreakStatement#" << this-> id << "*/";
 }
 
-void AstContinueStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstContinueStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstContinueStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(continue_token);
+    os << lex_stream -> NameString(continue_token);
     if (identifier_token_opt)
     {
         os << " ";
-        os << lex_stream.NameString(identifier_token_opt);
+        os << lex_stream -> NameString(identifier_token_opt);
     }
     os << ";" << endl;
     if (Ast::debug_unparse)
         os << "/*:AstContinueStatement#" << this-> id << "*/";
 }
 
-void AstReturnStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstReturnStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstReturnStatement:#" << this-> id << "*/";
     // Do NOT use this; when the return statement is not literally
     // present in the source, the return_token points at the next "}".
-    // os << lex_stream.NameString(return_token);
+    // os << lex_stream -> NameString(return_token);
     os << "return";
     if (expression_opt)
     {
@@ -723,11 +729,11 @@
         os << "/*:AstReturnStatement#" << this-> id << "*/";
 }
 
-void AstThrowStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstThrowStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstThrowStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(throw_token);
+    os << lex_stream -> NameString(throw_token);
     os << " ";
     expression -> Unparse(os, lex_stream);
     os << ";" << endl;
@@ -735,11 +741,11 @@
         os << "/*:AstThrowStatement#" << this-> id << "*/";
 }
 
-void AstSynchronizedStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstSynchronizedStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstSynchronizedStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(synchronized_token);
+    os << lex_stream -> NameString(synchronized_token);
     os << " ";
     AstParenthesizedExpression *parenth = expression -> ParenthesizedExpressionCast();
     if (!parenth)
@@ -753,11 +759,11 @@
         os << "/*:AstSynchronizedStatement#" << this-> id << "*/";
 }
 
-void AstCatchClause::Unparse(Ostream& os, LexStream& lex_stream)
+void AstCatchClause::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstCatchClause:#" << this-> id << "*/";
-    os << lex_stream.NameString(catch_token);
+    os << lex_stream -> NameString(catch_token);
     os << " (";
     formal_parameter -> Unparse(os, lex_stream);
     os << ")" << endl;
@@ -766,21 +772,22 @@
         os << "/*:AstCatchClause#" << this-> id << "*/";
 }
 
-void AstFinallyClause::Unparse(Ostream& os, LexStream& lex_stream)
+void AstFinallyClause::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstFinallyClause:#" << this-> id << "*/";
-    os << lex_stream.NameString(finally_token);
+    os << lex_stream -> NameString(finally_token);
     os << endl;
     block -> Unparse(os, lex_stream);
-    if (Ast::debug_unparse) os << "/*:AstFinallyClause#" << this-> id << "*/";
+    if (Ast::debug_unparse)
+        os << "/*:AstFinallyClause#" << this-> id << "*/";
 }
 
-void AstTryStatement::Unparse(Ostream& os, LexStream& lex_stream)
+void AstTryStatement::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstTryStatement:#" << this-> id << "*/";
-    os << lex_stream.NameString(try_token);
+    os << lex_stream -> NameString(try_token);
     os << endl;
     block -> Unparse(os, lex_stream);
     for (int k = 0; k < this -> NumCatchClauses(); k++)
@@ -791,127 +798,127 @@
         os << "/*:AstTryStatement#" << this-> id << "*/";
 }
 
-void AstIntegerLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstIntegerLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstIntegerLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(integer_literal_token);
+    os << lex_stream -> NameString(integer_literal_token);
     if (Ast::debug_unparse)
         os << "/*:AstIntegerLiteral#" << this-> id << "*/";
 }
 
-void AstLongLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstLongLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstLongLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(long_literal_token);
+    os << lex_stream -> NameString(long_literal_token);
     if (Ast::debug_unparse)
         os << "/*:AstLongLiteral#" << this-> id << "*/";
 }
 
-void AstFloatingPointLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstFloatingPointLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstFloatingPointLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(floating_point_literal_token);
+    os << lex_stream -> NameString(floating_point_literal_token);
     if (Ast::debug_unparse)
         os << "/*:AstFloatingPointLiteral#" << this-> id << "*/";
 }
 
-void AstDoubleLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstDoubleLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstDoubleLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(double_literal_token);
+    os << lex_stream -> NameString(double_literal_token);
     if (Ast::debug_unparse)
         os << "/*:AstDoubleLiteral#" << this-> id << "*/";
 }
 
-void AstTrueLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstTrueLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstTrueLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(true_literal_token);
+    os << lex_stream -> NameString(true_literal_token);
     if (Ast::debug_unparse)
         os << "/*:AstTrueLiteral#" << this-> id << "*/";
 }
 
-void AstFalseLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstFalseLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstFalseLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(false_literal_token);
+    os << lex_stream -> NameString(false_literal_token);
     if (Ast::debug_unparse)
         os << "/*:AstFalseLiteral#" << this-> id << "*/";
 }
 
-void AstStringLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstStringLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstStringLiteral:#" << this-> id << "*/";
     {
         bool old_expand = os.ExpandWchar();
         os.SetExpandWchar(true);
-        os << lex_stream.NameString(string_literal_token), lex_stream.NameStringLength(string_literal_token);
+        os << lex_stream -> NameString(string_literal_token), lex_stream -> NameStringLength(string_literal_token);
         os.SetExpandWchar(old_expand);
     }
     if (Ast::debug_unparse)
         os << "/*:AstStringLiteral#" << this-> id << "*/";
 }
 
-void AstCharacterLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstCharacterLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstCharacterLiteral:#" << this-> id << "*/";
     {
         bool old_expand = os.ExpandWchar();
         os.SetExpandWchar(true);
-        os << lex_stream.NameString(character_literal_token), lex_stream.NameStringLength(character_literal_token);
+        os << lex_stream -> NameString(character_literal_token), lex_stream -> NameStringLength(character_literal_token);
         os.SetExpandWchar(old_expand);
     }
     if (Ast::debug_unparse)
         os << "/*:AstCharacterLiteral#" << this-> id << "*/";
 }
 
-void AstNullLiteral::Unparse(Ostream& os, LexStream& lex_stream)
+void AstNullLiteral::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstNullLiteral:#" << this-> id << "*/";
-    os << lex_stream.NameString(null_token);
+    os << lex_stream -> NameString(null_token);
     if (Ast::debug_unparse)
         os << "/*:AstNullLiteral#" << this-> id << "*/";
 }
 
-void AstThisExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstThisExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstThisExpression:#" << this-> id << "*/";
-    os << lex_stream.NameString(this_token);
+    os << lex_stream -> NameString(this_token);
     if (Ast::debug_unparse)
         os << "/*:AstThisExpression#" << this-> id << "*/";
 }
 
-void AstSuperExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstSuperExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstSuperExpression:#" << this-> id << "*/";
-    os << lex_stream.NameString(super_token);
+    os << lex_stream -> NameString(super_token);
     if (Ast::debug_unparse)
         os << "/*:AstSuperExpression#" << this-> id << "*/";
 }
 
-void AstParenthesizedExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstParenthesizedExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstParenthesizedExpression:#" << this-> id << "*/";
-    os << lex_stream.NameString(left_parenthesis_token);
+    os << lex_stream -> NameString(left_parenthesis_token);
     expression -> Unparse(os, lex_stream);
-    os << lex_stream.NameString(right_parenthesis_token);
+    os << lex_stream -> NameString(right_parenthesis_token);
     if (Ast::debug_unparse)
         os << "/*:AstParenthesizedExpression#" << this-> id << "*/";
 }
 
-void AstTypeExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstTypeExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstTypeExpression:#" << this-> id << "*/";
@@ -920,13 +927,13 @@
         os << "/*:AstTypeExpression#" << this-> id << "*/";
 }
 
-void AstClassInstanceCreationExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstClassInstanceCreationExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstClassInstanceCreationExpression:#" << this-> id << "*/";
     if (dot_token_opt /* base_opt - see ast.h for explanation */)
         base_opt -> Unparse(os, lex_stream);
-    os << lex_stream.NameString(new_token);
+    os << lex_stream -> NameString(new_token);
     os << " ";
     class_type -> Unparse(os, lex_stream);
     os << "( ";
@@ -944,7 +951,7 @@
         os << "/*:AstClassInstanceCreationExpression#" << this-> id << "*/";
 }
 
-void AstDimExpr::Unparse(Ostream& os, LexStream& lex_stream)
+void AstDimExpr::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstDimExpr:#" << this-> id << "*/";
@@ -955,11 +962,11 @@
         os << "/*:AstDimExpr#" << this-> id << "*/";
 }
 
-void AstArrayCreationExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstArrayCreationExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstArrayCreationExpression:#" << this-> id << "*/";
-    os << lex_stream.NameString(new_token);
+    os << lex_stream -> NameString(new_token);
     os << " ";
     array_type -> Unparse(os, lex_stream);
     for (int i = 0; i < NumDimExprs(); i++)
@@ -972,18 +979,18 @@
         os << "/*:AstArrayCreationExpression#" << this-> id << "*/";
 }
 
-void AstFieldAccess::Unparse(Ostream& os, LexStream& lex_stream)
+void AstFieldAccess::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstFieldAccess:#" << this-> id << "*/";
     base -> Unparse(os, lex_stream);
-    os << lex_stream.NameString(dot_token);
-    os << lex_stream.NameString(identifier_token);
+    os << lex_stream -> NameString(dot_token);
+    os << lex_stream -> NameString(identifier_token);
     if (Ast::debug_unparse)
         os << "/*:AstFieldAccess#" << this-> id << "*/";
 }
 
-void AstMethodInvocation::Unparse(Ostream& os, LexStream& lex_stream)
+void AstMethodInvocation::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstMethodInvocation:#" << this-> id << "*/";
@@ -1000,7 +1007,7 @@
         os << "/*:AstMethodInvocation#" << this-> id << "*/";
 }
 
-void AstArrayAccess::Unparse(Ostream& os, LexStream& lex_stream)
+void AstArrayAccess::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstArrayAccess:#" << this-> id << "*/";
@@ -1012,27 +1019,27 @@
         os << "/*:AstArrayAccess#" << this-> id << "*/";
 }
 
-void AstPostUnaryExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstPostUnaryExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstPostUnaryExpression:#" << this-> id << "*/";
     expression -> Unparse(os, lex_stream);
-    os << lex_stream.NameString(post_operator_token);
+    os << lex_stream -> NameString(post_operator_token);
     if (Ast::debug_unparse)
         os << "/*:AstPostUnaryExpression#" << this-> id << "*/";
 }
 
-void AstPreUnaryExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstPreUnaryExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstPreUnaryExpression:#" << this-> id << "*/";
-    os << lex_stream.NameString(pre_operator_token);
+    os << lex_stream -> NameString(pre_operator_token);
     expression -> Unparse(os, lex_stream);
     if (Ast::debug_unparse)
         os << "/*:AstPreUnaryExpression#" << this-> id << "*/";
 }
 
-void AstCastExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstCastExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstCastExpression:#" << this-> id << "*/";
@@ -1050,20 +1057,20 @@
         os << "/*:AstCastExpression#" << this-> id << "*/";
 }
 
-void AstBinaryExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstBinaryExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstBinaryExpression:#" << this-> id << "*/";
     left_expression -> Unparse(os, lex_stream);
     os << " ";
-    os << lex_stream.NameString(binary_operator_token);
+    os << lex_stream -> NameString(binary_operator_token);
     os << " ";
     right_expression -> Unparse(os, lex_stream);
     if (Ast::debug_unparse)
         os << "/*:AstBinaryExpression#" << this-> id << "*/";
 }
 
-void AstConditionalExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstConditionalExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstConditionalExpression:#" << this-> id << "*/";
@@ -1076,13 +1083,13 @@
         os << "/*:AstConditionalExpression#" << this-> id << "*/";
 }
 
-void AstAssignmentExpression::Unparse(Ostream& os, LexStream& lex_stream)
+void AstAssignmentExpression::Unparse(Ostream& os, LexStream * lex_stream)
 {
     if (Ast::debug_unparse)
         os << "/*AstAssignmentExpression:#" << this-> id << "*/";
     left_hand_side -> Unparse(os, lex_stream);
     os << " ";
-    os << lex_stream.NameString(assignment_operator_token);
+    os << lex_stream -> NameString(assignment_operator_token);
     os << " ";
     expression -> Unparse(os, lex_stream);
     if (Ast::debug_unparse)
