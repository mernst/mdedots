#! /usr/bin/env python3

# Usage: mail-review-spam

# I would prefer not to display tabs containing "No messages matched your search."
# However, I don't see how to obtain the content of the page.
# This doesn't seem to work:  it doesn't get my cookies and shows the login page.
#   google-chrome --headless=new --user-data-dir --enable-logging --disable-gpu --dump-dom https://mail.google.com/mail/u/mernst@cs.washington.edu/#search/in%3Aspam+from%3A8x8 > out.html
# I guess I could do the culling within Emacs...


import time
import webbrowser


def mail_search(search_term: str) -> None:
    webbrowser.open(
        "https://mail.google.com/mail/u/"
        + "mernst@cs.washington.edu"
        + "/#search/in:spam+"
        + search_term
    )
    time.sleep(0.3)
    webbrowser.open(
        "https://mail.google.com/mail/u/"
        + "michael.ernst"
        + "/#search/in:spam+"
        + search_term
    )
    time.sleep(0.3)


# To avoid "Showing related results", double-quote the term.

print("Stop and re-start Chrome.")

input("Press ENTER")
print('Misspelled "Micheal"')

mail_search('"Micheal"')

input("Press ENTER")
print("Likely false positives (part 1)")

mail_search("from:amazon.com")
mail_search("from:builds@circleci.com")
mail_search("from:%22Google%20Calendar%22")
mail_search("from:%22Mail Delivery System%22")
mail_search("from:%22Mail%20Delivery@20Subsystem%22")
mail_search("from:auto-reply@usps.com")
mail_search("from:centurylink.com")
mail_search("from:checker-framework-dev")
mail_search("from:cs.washington.edu")
mail_search("from:fredhutch.org")
mail_search("from:hallowelltodaro.com")
mail_search("from:lls.org")
mail_search("from:lincolnseattleptsa.org")
mail_search("from:mygoodtogo.com")
mail_search("from:newyorktimes.com")
mail_search("from:sadieemurphey@gmail.com")
mail_search("from:seattlecca.org")
mail_search("from:spl.org")
mail_search("from:trenduw@uw.edu")
# mail_search("from:uwcascadia@uw.edu")
mail_search("from:uw.edu")
mail_search("from:washington.edu")

input("Press ENTER")
print("Likely false positives (part 2)")

mail_search("subject:%22security+alert+for%22")
mail_search("subject:seajug")
mail_search("subject:seworld")
mail_search("subject:typetools")
mail_search("to:drool@mit.edu")
mail_search("to:eit@mit.edu")
mail_search("to:mit1989@mailman-alum.mit.edu")
# mail_search("to:sgcyouth@googlegroups.com")

mail_search("%22Allen School%22")
mail_search("ecoop-info")
mail_search("lombok")
mail_search("maeveahowell@gmail.com")
mail_search('"plse"')
mail_search("uw-security-research")

input("Press ENTER")
print("Suspicious senders, part 1")

## Too broad
# mail_search("from:mail")
## Had no search results for 3 months
# mail_search("from:%22Mustafa%20Ayvaz%22")
# mail_search("from:%22Ted's%20Wood%20Working%22")
# mail_search("from:%22ZEISS%20Microscopy%22")
# mail_search("from:GreenNewDealNetwork.org")
# mail_search("from:Plantronics")
# mail_search("from:isualum@mail.iastate.edu")
# mail_search("%22Scoop+News%22") # nothing on 8/3/2022, 9/5/2022
# mail_search("CyberScoop") # nothing on 8/3/2022, 9/5/2022
# mail_search("EdScoop") # nothing on 8/3/2022, 9/5/2022
# mail_search("FedScoop") # nothing on 8/3/2022, 9/5/2022
# mail_search("StateScoop") # nothing on 8/3/2022, 9/5/2022
# mail_search("Fluke") # nothing on 8/3/2022, 9/5/2022
# mail_search("Pluralsight") # nothing on 8/3/2022, 9/5/2022
# mail_search("TeaParty.org") # nothing on 8/3/2022, 9/5/2022
# mail_search("angi") # nothing on 8/3/2022, 9/5/2022
# mail_search("cyberweek") # nothing on 8/3/2022, 9/5/2022

mail_search("(from:dr OR from:mr OR from:mrs OR from:ms)")

mail_search("from:%22Anand%20Raghavan%22")  # nothing on 9/5/2022 # nothing on 8/3/2023
mail_search("from:%22Cooling%20Bra%20Pro%22")  # nothing on 9/5/2022
mail_search("from:%22EMILYs List%22")  # nothing on 8/3/2023
mail_search("from:%22Fluke Corporation%22")  # nothing on 8/3/2023
mail_search("from:%22Harbor Freight%22")  # nothing on 8/3/2023
mail_search("from:%22IKA Works%22")
mail_search("from:%22Innovation%20News%20Network%22")
mail_search("from:%22Mend The Marriage%22")  # nothing on 8/3/2023
mail_search("from:%22Michael Weber%22")
mail_search("from:%22Survival Ops Tactical%22")  # nothing on 8/3/2023
mail_search("from:%22TPC Training%22")  # nothing on 8/3/2023
mail_search("from:%22Team OutSystems%22")  # nothing on 8/3/2023
mail_search("from:%22Tracy Zettinig%22")  # nothing on 8/3/2023
mail_search("from:%22Windstream Enterprise%22")  # nothing on 8/3/2023
mail_search("from:8x8")  # nothing on 8/3/2023
mail_search("from:webinars@training.businesswatchnetwork.com")
mail_search("from:expertspeak@email.concordeducations.com")

input("Press ENTER")
print("Suspicious senders, part 2")

mail_search("(from:AlertMedia OR from:Amazon OR from:BOXX OR from:Banco)")
mail_search("(from:BeTechly OR from:Bloomberg OR from:EDIBON OR from:ESET)")
mail_search("(from:Egnyte OR from:Ginja OR from:Helpdesk OR from:Hitradio)")
mail_search("(from:McAfee OR from:Norton OR from:Planview OR from:RingCentral)")
mail_search("from:SeguridadHB")
mail_search(
    "(from:Avantor OR from:ATC-NY OR from:SimpsonScarborough OR from:VinFuture)"
)
mail_search("(from:%22Check Point%22 OR from:%22Staples Technology Solutions%22)")
mail_search("(from:FB)")

input("Press ENTER")
print("Suspicious senders, part 3")

# mail_search("from:bee@BAUER.UH.EDU")  # nothing on 8/3/2023
mail_search("(from:blr OR from:cardio OR from:convergetp.com OR from:demings)")
mail_search("(from:fortinet OR from:imperva OR from:liberator OR from:linkedin)")
mail_search(
    "(from:sci_ed@info.vwr.com OR from:sonicwall OR from:uCertify OR from:whitmer)"
)
mail_search("(from:CashApp OR from:temu OR from:howida)")
mail_search("from:email")
mail_search("(from:bytesize OR from:nfina)")


# These do not include "from:" in the search
mail_search("(%22golf+wire%22 OR Speechelo OR Syxsense OR labelbox OR techwatch)")
mail_search("bara@kolliers.com")


input("Press ENTER")
print("Suspicious senders, part 4")

mail_search("from:journal")
mail_search("from:team")

mail_search("from:trump")

input("Press ENTER")
print("Likely false positive")

mail_search("subject:invitation")

input("Press ENTER")
print("Mail forged to be from me")

mail_search("(from:michaelernst OR from:michael.ernst OR from:mernst)")

input("Press ENTER")
print("My name in the subject line")

# also catches "Michael Ernst"
mail_search("(subject:michaelernst OR subject:michael.ernst OR subject:mernst)")

input("Press ENTER")
print('"Michael" in the subject line or "Hi Michael"')

mail_search("subject:Michael")
mail_search("%22Hi Michael%22")
mail_search("subject:cs.washington.edu")

input("Press ENTER")
print("Frequent topics")

## These are not so useful
# mail_search("Seattle")
# mail_search("democratic")
# mail_search("republican")
# mail_search("subject:Trump")
## These did not occur for 3 months
# mail_search("CBD")
# mail_search("Imperva")
# mail_search("KN95")
# mail_search("fuckbuddy")
# mail_search("hookup")
# mail_search("pussy")
# mail_search("temperature")

mail_search("%22nick+hellen%22")

mail_search("subject:conference OR Scopus")
mail_search("subject:confirmation")
mail_search("subject:donation")
mail_search("subject:investment")
mail_search("subject:journal")
mail_search("subject:quota")
mail_search("subject:urgent")
mail_search("subject:spam")
mail_search("subject:strategies")

mail_search("Casino")
mail_search("(bitcoin OR crypto)")
mail_search("(coronavirus OR covid)")
mail_search("diabetes")
mail_search("fuckme")
mail_search("indonesia")  # nothing on 2/3/2023
mail_search("(keto OR ketosis)")  # nothing on 8/3/2022
mail_search("docusign")
mail_search("elongation")
mail_search("trump")

# mail_search("Kamala Harris")

input("Press ENTER")
print('Foreign languages and emojis (watch out for "Showing related results")')

## These emoji searches do not work; the search matches all emails.
# mail_search("üíã")
# mail_search("‚ù§")
# mail_search("üíò")
## It works if I abut it with a word, like this:
## mail_search("üî•H0T")

# German
# This does not seem to work; at least, a "Herzlichen Gl√ºckwunsch" email remained
mail_search(
    '("Gesch√§ft" OR "Sehr geehrter" OR "und mit" OR "nur vom" OR "wie geht es dir" OR "mit der" OR "Herzlichen" OR "Gl√ºckwunsch" OR "ich bin" OR "kann ich" OR ("wir" AND "die") OR ("ab" AND "im") OR ("und" AND "von") OR ("ist" AND "diese") OR "guten tag" OR "spende")'
)
# Portuguese
mail_search(
    '"A√ß√£o" OR Requerida OR "Atualiza√ß√£o" OR Importante OR Notificacao OR aprova√ß√£o OR reclama√ß√£o OR eletr√¥nica OR curriculo OR Investiga√ß√£o'
)
# Spanish
mail_search("(mejor AND opci√≥n) OR (en su)")
# Russian
mail_search("–∏")
# Polish
mail_search("Proszƒô OR S≈Çowa OR Dzie≈Ñ OR zwiƒÖzku")
# Italian
mail_search("Fattura OR pagata")
# Chinese
mail_search("Êßò")


# NOTE: Most of these aren't a problem because the email subject sorts at the end when I review the email in Emacs Mew.
# mail_search("–ö")
# mail_search("–∏")
# mail_search("–≤")
# mail_search("—è")
# mail_search("ŸÅŸä")
# mail_search("ŸÖÿßÿ±ÿ≥")

input("Now the rest (read these in Emacs, probably at CSE); press ENTER")
print("1. Sort by from, look for frequent senders with non-uniform subject lines.")
print("2. Sort by subject, scan for non-spam.")
print("3. Delete all spam from Gmail.")

## I don't use Mew any longer; with it, I used the spam-todo label
# webbrowser.open("https://mail.google.com/mail/u/"+google_acct_a+"/#label/spam-todo")
# webbrowser.open("https://mail.google.com/mail/u/"+google_acct_b+"/#label/spam-todo")
webbrowser.open("https://mail.google.com/mail/u/mernst@cs.washington.edu/#spam")
webbrowser.open("https://mail.google.com/mail/u/michael.ernst/#spam")
